/* !zhao_wipe 1.0.1 发布日期:2018-11-14*/
var canvas=document.getElementById("cas"),context=canvas.getContext("2d"),_w=canvas.width,_h=canvas.height,t=0,moveX=0,moveY=0,isMouseDown=!1,device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),radius=20;console.log(navigator.userAgent),console.log(device);var clickEvtName=device?"touchmove":"mousedown",moveEvtName=device?"touchmove":"mousemove",endEvtName=device?"touchend":"mouseup";function drawMask(e){e.fillStyle="#666",e.fillRect(0,0,_w,_h),e.globalCompositeOperation="destination-out"}function drawT(e,t,n,o,a){3===arguments.length?(e.save(),e.beginPath(),e.arc(t,n,radius,0,2*Math.PI),e.fillStyle="red",e.fill(),e.restore()):5===arguments.length&&(e.save(),e.lineCap="round",e.lineWidth=2*radius,e.beginPath(),e.moveTo(t,n),e.lineTo(o,a),e.stroke(),e.restore())}function fn2(e){isMouseDown=!1,50<getTransparencyPercent(context)&&(alert("超出了50%的面积"),clearRech(context))}function clearRech(e){e.clearRect(0,0,_w,_h)}function getTransparencyPercent(e){for(var n=e.getImageData(0,0,_w,_h),o=0;o<n.data.length;o+=4){0===n.data[o+3]&&t++}var a=t/(_w*_h)*100;return console.log("透明点的个数:"+t),console.log("占地面积"+Math.ceil(a)+"%"),Math.round(a)}cas.addEventListener(clickEvtName,function(e){isMouseDown=!0;var t=e||window.event;moveX=device?t.touches[0].clientX:t.clientX,moveY=device?t.touches[0].clientY:t.clientY,drawT(context,moveX,moveY)},!1),cas.addEventListener(moveEvtName,function(e){if(!isMouseDown)return!1;var t=e||window.event;t.preventDefault();var n=device?t.touches[0].clientX:t.clientX,o=device?t.touches[0].clientY:t.clientY;drawT(context,moveX,moveY,n,o),moveX=n,moveY=o},!1),cas.addEventListener(endEvtName,fn2,!1),window.onload=function(){drawMask(context)};